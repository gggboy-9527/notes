![](.\windows代理设置.png)

解释windows的代理设置的每一项的含义：

### 🔹 自动检测设置

- **开关**：关
- **含义**：不自动尝试探测网络中的代理配置（如 PAC 文件）
- ✅ 一般关闭，除非公司内网有自动代理策略

### 🔹 使用设置脚本

- **开关**：关

- **脚本地址**：`http://127.0.0.1:1080/pac?auth=nKGXpkbZ`

- 含义：

  - 如果开启，系统会加载一个 **PAC（Proxy Auto-Config）文件**
  - 这个文件是一个 JavaScript 脚本，告诉浏览器：“哪些网址走代理？哪些不用？”
  - 比如：`if (hostname == "youtube.com") return "PROXY 127.0.0.1:7890";`

- ⚠️ 当前是关闭状态，所以不会自动执行 PAC

  注意，这两个关于PAC的东西，现在基本不用了，PAC，已经淘汰了，但是极少数老的东西在用；如果想了解，可以去PAC那个笔记了解；

  请注意这两个设置的解释：

  > **“自动检测设置”开启后，Windows 会尝试通过 WPAD（Web Proxy Auto-Discovery Protocol）协议自动发现 PAC 文件的位置

  换句话说：

  - **“自动检测” ≠ 使用你填的“使用设置脚本”地址**
  - 它是**完全独立的一套自动发现机制**，主要用于企业/学校网络

  ------

  🔍 一、两个设置的关系（先划清界限）

  | 设置项           | 作用                       | 是否依赖对方           |
  | ---------------- | -------------------------- | ---------------------- |
  | **自动检测设置** | 启用 WPAD 协议，自动找 PAC | ❌ 不依赖“使用设置脚本” |
  | **使用设置脚本** | 手动指定一个 PAC URL       | ❌ 不依赖“自动检测”     |

  > ✅ 它们是**互斥或并存**的两种方式：
  >
  > - 如果你**手动填了 PAC 地址** → Windows 直接用它，**忽略自动检测**
  > - 如果你**没填地址但开了自动检测** → Windows 尝试用 WPAD 找 PAC
  > - 如果**两个都关** → 不使用任何 PAC，只用“手动代理”设置（如果有）

  ------

  🌐 二、“自动检测”到底在检测什么？

  它使用的是 **WPAD（Web Proxy Auto-Discovery Protocol）**，由微软和 Netscape 在 1990 年代提出。

  ### WPAD 会尝试两种方式找 PAC 文件：

  ### 方式 1️⃣：通过 **DHCP** 获取

  - 电脑向 DHCP 服务器（通常是路由器）请求 IP 时，顺便问：

    > “有没有 WPAD 服务器地址？”

  - 如果 DHCP 返回一个 URL（如 `http://proxy.company.com/proxy.pac`），Windows 就用它

  ### 方式 2️⃣：通过 **DNS** 查询

  - 假设你当前域名是 `corp.example.com`

  - Windows 会依次尝试访问：

    ```
    http://wpad.corp.example.com/wpad.dat
    http://wpad.example.com/wpad.dat
    http://wpad.com/wpad.dat      ←（危险！可能被劫持）
    ```

  - 如果某个地址返回有效的 PAC 文件（内容类型为 `application/x-ns-proxy-autoconfig`），就使用它

  > 📌 注意：**这个过程完全不涉及你 Clash 里填的 `http://127.0.0.1:1080/pac...` 地址！**

------

### 🔹 手动设置代理（重点！）

#### ✅ 使用代理服务器：**开**

- 表示所有网络请求都经过代理服务器处理。

#### 📍 地址：`127.0.0.1`

- 就是 **本机**（localhost）
- 说明代理服务运行在你自己电脑上（比如 Clash、SwitchyOmega、V2RayN 等软件）

#### 🔢 端口：`7890`

- 代理服务监听的端口号
- 常见端口：`7890`, `1080`, `1081`, `8080`
- 你需要确保这个端口没有被占用，且代理软件正在运行

#### 📝 请勿对以下条目开头的地址使用代理服务器

- 输入框内容：

  ```
  localhost;127.*;10.*;172.16.*;172.17.*;172.18.*;172.19.*;172.20.*;172.21.*
  ```

- **含义**：这些是**局域网或本地地址**，不需要走代理

- ✅ 防止你访问家里的路由器、打印机等设备时也被代理干扰

#### ✅ 请勿将代理服务器用于本地(Intranet)地址

- 这个勾选的意思是：**不要把内网地址也交给代理处理**
- 与上面的列表一致，防止代理失败或变慢

#### 📦 保存按钮

- 点击后应用设置，重启浏览器或系统可能需要重新连接

------

**然后我们需要知道这一点：**

**一、系统代理设置 ≠ 全局强制代理**

### 📌 事实：

Windows / macOS / Linux 的“系统代理设置”（比如你截图中的 `127.0.0.1:7890`）**只是一个建议性配置**，并不是操作系统强制执行的网络规则。

- **浏览器**（Chrome、Edge、Firefox 等）：✅ 默认会读取系统代理。
- **部分现代应用**（如 VS Code、Postman、Discord）：✅ 支持系统代理。
- 但很多程序完全忽略它：
  - 游戏客户端
  - 桌面软件（如微信、QQ）
  - 自己用 Python/Go/C++ 写的程序（除非你显式写代码处理）
  - 命令行工具（如 `curl`, `wget`, `git`）—— **默认不走代理！**

> 🔥 核心原因：**代理是应用层（OSI 第7层）的概念**，而操作系统内核并不强制所有流量必须经过代理。

------

**二、程序如何“知道”要走代理？**

程序必须**主动查询系统代理设置**，并在发起网络请求时**手动配置代理参数**。

### 举几个例子：

#### ✅ 浏览器（自动走代理）

- 启动时读取系统代理设置
- 所有 HTTP/HTTPS 请求自动通过 `127.0.0.1:7890` 转发

#### ❌ 自己写的 Python 程序（默认不走！）

```
import requests
requests.get("https://www.google.com")  # ← 这个请求**不会走系统代理**！
```

除非你显式指定：

```
proxies = {
    "http": "http://127.0.0.1:7890",
    "https": "http://127.0.0.1:7890"
}
requests.get("https://www.google.com", proxies=proxies)  # ← 这样才走
```

#### ❌ 命令行 `curl`

```
curl https://google.com  # ← 不走代理
```

必须加参数：

```
curl -x http://127.0.0.1:7890 https://google.com  # ← 才走
```

#### ❌ 微信/QQ/Steam 等桌面软件

- 这些程序通常**硬编码连接方式**，完全无视系统代理
- 它们的更新、登录、消息推送等流量**直接连服务器 IP**，绕过代理

------

**三、如何让“所有程序”都走代理？——两种方案**

### 方案 1️⃣：使用 **全局透明代理（TUN/TAP 模式）**

> 这是 Clash、V2Ray、Surge 等高级工具提供的功能。

#### 原理：

- 创建一个虚拟网卡（TUN 设备）
- 通过系统路由表，把**所有出站流量**重定向到这个虚拟网卡
- 代理软件在虚拟网卡上监听，自动识别协议并转发

#### 效果：

- ✅ 所有程序（包括游戏、命令行、自研软件）**无感知地走代理**
- 即使程序没写代理支持，也能翻墙

#### 如何开启？

- 在 Clash for Windows 中勾选 **“TUN Mode”**
- 在 Surge / Quantumult X 中开启 **“Enhanced Mode”**
- Linux 下可用 `iptables + redsocks` 实现类似效果

> ⚠️ 注意：TUN 模式需要管理员/root 权限，且可能影响本地网络（如局域网设备访问）

------

### 方案 2️⃣：使用 **VPN 模式（或系统级代理）**

- 将代理工具配置为 **系统 VPN**（如 Clash Meta 支持 WireGuard 模式）
- 或使用 OpenVPN / ShadowsocksR 的全局模式
- 此时操作系统会把**所有流量**通过虚拟隧道发送

#### 优点：

- 真正全局，100% 覆盖
- 程序无法绕过

#### 缺点：

- 配置复杂
- 可能导致国内网站变慢（因为也走了代理）
- 需要额外分流规则（如 Clash 的 Rule-based 模式）

------

**四、验证你的程序是否走了代理**

### 方法 1：看代理软件的日志

- 打开 Clash，访问一个网站
- 如果日志里出现该域名的请求记录 → 说明走了代理
- 如果没出现 → 程序绕过了代理

### 方法 2：用 `netstat` 或 `Wireshark` 抓包

```
# Windows
netstat -ano | findstr :443

# Linux/macOS
lsof -i :443
```

- 如果看到你的程序直连 `google.com` 的 IP（如 `142.250.x.x`）→ **没走代理**
- 如果只看到连接 `127.0.0.1:7890` → **走了代理**

------

**五、总结：关键结论**

| 问题                                 | 答案                                   |
| ------------------------------------ | -------------------------------------- |
| **系统代理设置是否对所有程序生效？** | ❌ 否，仅对“主动读取代理配置”的程序有效 |
| **浏览器会走代理吗？**               | ✅ 是（默认）                           |
| **自己写的程序会走吗？**             | ❌ 否，除非你代码里显式设置代理         |
| **如何强制所有流量走代理？**         | ✅ 使用 TUN 模式 或 全局 VPN            |
| **微信、Steam 会走代理吗？**         | ❌ 通常不会                             |

------

所以说，我们下面介绍一下clash：

首先我们看General的这个配置：

![](.\clash.png)

## 🔹 1. **Port**（端口）

- **当前值：7890**
- **含义**：Clash 本地代理服务监听的端口号。
- 说明：
  - 所有需要走代理的程序（如浏览器、Postman）都会连接到 `127.0.0.1:7890`。
  - 常见端口：`7890`, `1080`, `8080`
- ✅ **推荐保持默认 7890**，除非你已占用或想避免冲突。

------

## 🔹 2. **Allow LAN**（允许局域网访问）

- **开关：开启**
- **含义**：是否允许其他设备通过本机的 Clash 代理上网。
- 说明：
  - 开启后，同一局域网内的手机、平板等设备可以设置代理为 `开启clash的电脑IP:7890` 来共享翻墙。
  - 例如：手机 Wi-Fi 设置 → 手动代理 → 服务器：`192.168.1.100`（这个地址假设就是开启clash的电脑的ip），端口：`7890`
  - 解释一下为什么这是可行的：假设我在家里，我家的路由器，提供了一个无线网，我的手机连接这个无线网；我的路由器，有一根有线的网线，连接我的电脑；应为这是在家里，所有网线上的电脑和无限网内属于在一个网络环境下，所以他们能够相互访问；此时，我把手机的无线网的代理设置为我电脑的地址，由于clash是在7890端口运行，所以我用我电脑的ip+7890，等于我的手机访问了我的电脑，所以手机也能科学上网；就是说原来，我手机发出的流量直接去了路由器，现在由于手机设置的代理，所以他去了我的电脑
- ⚠️ 安全提示：
  - 若不希望别人用你的代理，关闭此选项。
  - 可结合防火墙限制访问权限。

------

## 🔹 3. **Bind: ***（绑定地址）

- **开关：绿色（开）**

- **含义**：Clash 是否监听所有网络接口（包括外网 IP），而不仅仅是 `127.0.0.1`。

- 说明：

  - 开启时，Clash 会监听 `0.0.0.0:7890`，允许外部设备连接。
  - 关闭时，只监听 `127.0.0.1:7890`，仅限本机使用。

- ✅ **一般保持开启**，以便支持局域网共享。

- 这个功能也需要解释一下：首先解释：**什么是“网络接口”？**

  你可以把**网络接口**想象成电脑上的“网口”或“通信通道”。他是**一个可以让其他设备（或自己）通过特定 IP 地址与你的电脑通信的通道。**每一种连接方式，就对应一个接口：

  | 接口类型                 | 物理/虚拟 | 作用                             |
  | ------------------------ | --------- | -------------------------------- |
  | **以太网口（有线）**     | 物理      | 插网线连路由器                   |
  | **Wi-Fi 适配器**         | 物理      | 连无线网络                       |
  | **回环接口（Loopback）** | 虚拟      | 电脑自己和自己通信               |
  | **蓝牙网络**             | 虚拟/物理 | 通过蓝牙共享网络                 |
  | **虚拟机网卡**           | 虚拟      | 如 VMware、Docker 创建的虚拟网络 |

  > ✅ 每个网络接口都可以有自己的 **IP 地址**。也就是说，我们的电脑提供了这些接口来和外部交流；
  >
  > > **Clash 能监听所有网络接口，是因为它在启动时调用了操作系统的 `bind()` 系统调用，并传入了特殊地址 `0.0.0.0` —— 这告诉操作系统：“请把发往本机 \*任意 IP\* 的 7890 端口的连接，都交给我处理。”**
  >
  > ------
  >
  > ## 🔍 一、先理解：什么是“监听一个端口”？
  >
  > 当你运行 Clash 并说“监听 7890 端口”，本质是：
  >
  > 1. Clash 向操作系统申请：“我要接收发往 **某个 IP 地址:7890** 的 TCP 连接”
  > 2. 操作系统内核维护一张 **“监听套接字表”（listening socket table）**
  > 3. 当有外部设备发来 TCP 包（目标 IP + 目标端口），内核查这张表：
  >    - 如果匹配 → 把连接交给对应的程序（如 Clash）
  >    - 如果不匹配 → 返回 “Connection refused” 或静默丢弃
  >
  > ------
  >
  > ## 🧩 二、关键：`bind()` 时指定的 IP 决定了“监听范围”
  >
  > ### 情况 1️⃣：Clash **只监听 `127.0.0.1:7890`**（Bind 关闭）
  >
  > - Clash 调用：`bind("127.0.0.1", 7890)`
  > - 操作系统记录：**只有目标 IP 是 `127.0.0.1` 的 7890 请求才交给 Clash**
  > - 结果：
  >   - ✅ 本机浏览器访问 `http://127.0.0.1:7890` → 成功
  >   - ❌ 手机访问 `http://192.168.1.100:7890` → 失败（因为目标 IP 是 `192.168.1.100`，不在监听列表）
  >
  > > 💡 此时，Clash **根本不知道**有来自手机的请求——操作系统直接拒绝了。
  >
  > ------
  >
  > ### 情况 2️⃣：Clash **监听 `0.0.0.0:7890`**（Bind 开启）
  >
  > - Clash 调用：`bind("0.0.0.0", 7890)`
  >
  > - ```
  >   0.0.0.0
  >   ```
  >
  >   是一个
  >
  >   特殊通配符地址
  >
  >   ，意思是：
  >
  >   > “监听本机 **所有 IPv4 网络接口**上的 7890 端口”
  >
  > - 操作系统会为
  >
  >    
  >
  >   每个活动的网络接口
  >
  >   自动创建监听项：
  >
  >   - `127.0.0.1:7890`
  >   - `192.168.1.100:7890`（Wi-Fi）
  >   - `192.168.0.50:7890`（有线，如果有）
  >   - （如果有公网 IP）也会监听它
  >
  > > ✅ 所以当手机发请求到 `192.168.1.100:7890`：
  > >
  > > - 操作系统发现这个 IP + 端口被 Clash 监听
  > > - 立刻把连接交给 Clash
  > > - Clash 完全不知道“是从哪个接口进来的”，它只看到“有人连我 7890 了”

  ------

  

  ## 🌐 二、常见的三种 IP 地址（对应三种“出口”）

  ### 1️⃣ `127.0.0.1` —— **本地回环接口（Loopback）**

  - **这是什么？**
    一个**纯软件虚拟的网络接口**，只存在于你自己的电脑内部。

  - **作用是什么？**
    让程序之间在本机通信，**不经过任何物理网卡**。

  - 例子

    ：

    - 你在浏览器访问 `http://127.0.0.1:8080` → 实际是访问你电脑上运行的 Web 服务
    - Clash 监听 `127.0.0.1:7890` → 只有本机程序能连接它

  - 关键特性

    ：

    - 外部设备（手机、别人电脑）**永远无法访问 `127.0.0.1`**
    - 所有操作系统都有这个接口

  > 💡 你可以把它理解为：“电脑给自己留的一条内部电话线”。

  ------

  ### 2️⃣ `192.168.1.100` —— **局域网接口（LAN Interface）**

  - **这是什么？**
    你的**有线网卡**或**Wi-Fi 网卡**被路由器分配的 IP 地址。

  - **谁分配的？**
    家里的**路由器**（通过 DHCP 协议）。

  - **作用是什么？**
    让你在**家庭/公司局域网内**和其他设备通信。

  - 例子

    ：

    - 你的电脑 IP 是 `192.168.1.100`
    - 手机 IP 是 `192.168.1.101`
    - 你们可以互相访问共享文件夹、打印机、或者 Clash 代理

  - 关键特性

    ：

    - 只能在**同一个路由器下**的设备之间访问
    - 外网（互联网）**看不到这个 IP**

  > 💡 这是你在家里的“房间号”，只有同楼（同局域网）的人知道。

  ------

  ### 3️⃣ `203.0.113.45` —— **公网接口（Public/WAN Interface）**

  - **这是什么？**
    一个可以在**整个互联网上被访问**的 IP 地址。

  - **谁拥有它？**
    在家庭宽带中，**通常是你的光猫或路由器**拥有公网 IP，**不是你的电脑**！

  - 你的电脑有公网 IP 吗？❌

    一般没有

    。因为：

    - 运营商给路由器分配一个公网 IP（如 `203.0.113.45`）
    - 路由器通过 **NAT** 把内网设备（`192.168.1.100`）映射出去
    - 外网看到的是 `203.0.113.45`，不知道你内网的存在

    ------

    **默认情况（Bind 关闭）**：

    - Clash 只监听 `127.0.0.1:7890`
    - → 只有本机程序（如浏览器）能连接
    - → 手机连不上（因为手机不是 `127.0.0.1`）

    **🔓 开启 Bind（即监听 `0.0.0.0:7890`）：**

    - `0.0.0.0` 是一个特殊地址，意思是：“**监听本机所有网络接口**”
    - 即同时监听：
      - `127.0.0.1:7890`（本机）
      - `192.168.1.100:7890`（局域网）
      - （如果有公网 IP）也会监听公网接口

    > ✅ 所以：**开启 Bind = 允许局域网设备（如手机）连接你的 Clash 代理**

------

## 🔹 4. **Log Level**（日志级别）

- **当前值：info**
- **含义**：控制 Clash 输出日志的详细程度。
- 可选值：
  - `silent`：完全静默（不输出任何日志）
  - `error`：只记录错误
  - `info`：记录关键信息（推荐）
  - `debug`：超级详细，用于排查问题（可能影响性能）
- ✅ **推荐设为 info**，既能看到正常运行状态，又不会太乱。

------

## 🔹 5. **IPv6**

- **开关：红色（关）**
- **含义**：是否启用 IPv6 支持。
- 说明：
  - 大多数国内网络仍以 IPv4 为主，且很多代理节点不支持 IPv6。
  - 开启可能导致部分流量异常或无法连接。
- ✅ **一般关闭即可**，除非你明确需要 IPv6 流量。

------

## 🔹 6. **Clash Core**（内核版本）

- **显示：2023.08.17-13-gdcc8d87 Premium (56815)**
- **含义**：Clash 的底层代理引擎版本。
- 说明：
  - Clash for Windows 是前端，真正的“干活”由 Core 完成。
  - “Premium” 表示这是付费版（含高级功能，如 TUN、规则优化等）。
  - 点击右侧图标可更新内核。
- ✅ **建议定期更新**，以获得更好的兼容性和性能。

------

## 🔹 7. **Home Directory**（主目录）

- **按钮：Open Folder**
- **含义**：Clash 存放配置文件、订阅链接、日志等数据的根目录。
- **典型路径**：`C:\Users\你的用户名\.config\clash`
- 内容包括：
  - `config.yaml`：主配置文件
  - `profiles/`：订阅规则文件
  - `logs/`：运行日志
- ✅ 点击“Open Folder”可以查看并手动修改配置。

------

## 🔹 8. **UWP Loopback**

- **按钮：Launch Helper**
- **含义**：解决 Windows UWP 应用（如 Microsoft Store、Edge）无法访问本地代理的问题。
- 说明：
  - UWP 应用受沙箱限制，默认不能访问 `127.0.0.1` 或本地服务。
  - 启用后，Clash 会自动注册一个系统级回环接口，让 UWP 能正确走代理。
- ✅ **强烈建议开启**，尤其是你想用 Edge 浏览器翻墙时。

------

## 🔹 9. **TAP Device**（虚拟网卡）【和**TUN Mode**（TUN 模式）结合使用】

- **按钮：Manage**
- **含义**：创建一个虚拟网卡（TAP-Win32），用于实现 **透明代理（TUN 模式）**。
- 说明：
  - 通过 TAP 设备，Clash 可以拦截并重定向所有网络流量。
  - 是实现“全局代理”的基础。
- ✅ **通常不需要手动管理**，Clash 会在需要时自动安装。

------

## 🔹 10. **Service Mode**（服务模式）

- **按钮：Manage**
- **含义**：将 Clash 运行为 Windows 服务，使其在后台持续运行。
- 优点：
  - 即使你关闭 Clash 窗口，它仍在后台工作。
  - 可以开机自启。
- ✅ **建议开启**，特别是你希望长期稳定使用代理。

------

## 🔹 11. **TUN Mode**（TUN 模式）【和**TAP Device**（虚拟网卡）结合使用】

- **开关：绿色（开）**
- **含义**：启用 **透明代理**，让所有程序（包括游戏、命令行、未支持代理的软件）无感知地走代理。
- 原理：
  - 创建一个虚拟网络接口（TUN/TAP）
  - 修改系统路由表，把所有出站流量导向该接口
  - Clash 在接口上监听并转发请求
- ✅ **这是实现“全局代理”的核心技术**！
- ⚠️ 注意：
  - 需要管理员权限
  - 可能导致某些本地服务（如打印机、NAS）无法访问
  - 推荐搭配 **分流规则** 使用（如只对国外网站走代理）

------

## 🔹 12. **Mixin**（混合模式）

- **开关：红色（关）**
- **含义**：是否启用 Mixin 插件（如广告过滤、DNS 加速等）。
- 说明：
  - Mixin 是第三方插件系统，提供额外功能。
  - 一般用户无需开启。
- ✅ **保持关闭即可**，除非你有特殊需求。

------

## 🔹 13. **System Proxy**（系统代理）

- **开关：绿色（开）**
- **含义**：是否将 Clash 的代理设置为系统的默认代理。
- 效果：
  - 自动设置 Windows 的代理为 `127.0.0.1:7890`
  - 浏览器、邮件客户端等会自动走代理
- ✅ **建议开启**，方便日常浏览网页。
- **注意，这个开启后，他会默认自动的把我们电脑上的那个代理设置的“使用代理服务器”打开，然后地址，端口，请勿对下列条目开头的地址使用代理服务器；这些他都会自己自动填写**

------

## 🔹 14. **Start with Windows**（开机启动）

- **开关：红色（关）**
- **含义**：是否随 Windows 启动自动运行 Clash。
- 说明：
  - 开启后，每次开机都会自动加载代理。
  - 适合需要长期翻墙的用户。
- ✅ **如果你常用 Clash，建议开启**。

------



### 🧩 关键澄清：程序到底看哪个代理？

#### 情况 A：你开启了 **System Proxy（即 Windows 代理已设置）**

- 浏览器（Chrome/Edge/Firefox）→ ✅ 自动走代理
- Python requests（未显式设 proxy）→ ❌ 不走（除非读环境变量）
- 命令行 curl → ❌ 不走（除非加 `-x` 参数）

#### 情况 B：你**关闭了 System Proxy**，但 Clash 仍在运行（TUN Mode 开启）

- 所有程序（包括浏览器、curl、自研程序）→ ✅ 全部走代理（因为 TUN 模式是底层重定向）

#### 情况 C：你**关闭了 System Proxy**，且 **TUN Mode 也关闭**

- 浏览器 → ❌ 不走代理（因为 Windows 代理没开）
- 但如果你在代码里**硬编码了 `127.0.0.1:7890`** → ✅ 走代理

