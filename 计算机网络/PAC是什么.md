## ✅ 一句话定义 PAC：

> **PAC 是一个 JavaScript 脚本文件，用来告诉浏览器（或系统）：“访问哪些网站走代理，哪些直连”。**

它的核心是一个函数：

```
function FindProxyForURL(url, host) {
    // 返回代理规则
}
```

------

## 🔍 一、PAC 是怎么工作的？

### 场景举例：

你想实现：

- 访问 `google.com` → 走代理
- 访问 `baidu.com` → 直连

### PAC 脚本可能长这样：

```
function FindProxyForURL(url, host) {
    // 如果是国外域名，走代理
    if (shExpMatch(host, "*.google.com") ||
        shExpMatch(host, "*.youtube.com")) {
        return "PROXY 127.0.0.1:7890";
    }
    
    // 其他所有网站直连
    return "DIRECT";
}
```

### 浏览器行为：

1. 用户输入 `https://www.youtube.com`
2. 浏览器读取 PAC 文件
3. 调用 `FindProxyForURL("https://www.youtube.com", "www.youtube.com")`
4. 函数返回 `"PROXY 127.0.0.1:7890"`
5. 浏览器自动连接 `127.0.0.1:7890` 发起代理请求

> ✅ 这样就实现了**自动分流**，无需手动切换代理！

------

## 🌐 二、PAC 文件从哪里来？

| 来源              | 说明                                                       |
| ----------------- | ---------------------------------------------------------- |
| **手动指定 URL**  | 如你在 Windows 里填的 `http://127.0.0.1:1080/pac?auth=xxx` |
| **DHCP 自动下发** | 公司网络通过 DHCP 告诉电脑：“去拿这个 PAC 文件”            |
| **WPAD 协议**     | 浏览器自动尝试访问 `http://wpad/wpad.dat`（已基本淘汰）    |

> 💡 在 Clash 中，当你开启 **Allow LAN + HTTP 代理**，Clash 会**动态生成一个 PAC 文件**，并通过内置 HTTP 服务器提供（如 `http://127.0.0.1:7890/pac`）。

------

## ⚙️ 三、Clash 的 PAC 和它的规则有什么关系？

Clash 本身有一套强大的规则系统（Rule-based），比如：

```
rules:
  - DOMAIN-SUFFIX,google.com,PROXY
  - GEOIP,CN,DIRECT
  - MATCH,PROXY
```

当你启用 PAC 功能时，Clash 会**把这套规则转换成 JavaScript 函数**，生成一个实时的 `pac` 文件。

所以：

- PAC = Clash 规则的“浏览器兼容版本”
- 它让**不支持 TUN、也不懂手动代理的旧软件**也能智能分流

------

## 🆚 四、PAC vs System Proxy vs TUN —— 三者区别

| 方式                         | 工作层级           | 分流能力                             | 兼容性                             | 典型用途         |
| ---------------------------- | ------------------ | ------------------------------------ | ---------------------------------- | ---------------- |
| **System Proxy（全局代理）** | 应用层             | ❌ 所有流量走同一代理                 | 高（现代软件都支持）               | 简单翻墙         |
| **PAC**                      | 应用层（JS 脚本）  | ✅ 按域名智能分流                     | 中（浏览器支持好，部分软件不支持） | 企业网络、旧系统 |
| **TUN Mode**                 | 网络层（虚拟网卡） | ✅ 最强大（支持 IP、端口、协议、UDP） | 高（操作系统级）                   | 全局透明代理     |

### 举个例子：

- 你用 **System Proxy** → 所有网站都走代理（包括百度，变慢）
- 你用 **PAC** → 浏览器能智能分流，但 Steam 游戏仍直连（不走代理）
- 你用 **TUN** → 浏览器、Steam、微信、命令行……全部按规则分流

> 📌 所以：**PAC 是“浏览器时代的智能代理”，TUN 是“现代操作系统的终极方案”**

------

## ⚠️ 五、为什么现在一般关掉 PAC？

1. **TUN 更强大**：PAC 只能基于域名判断，无法处理 IP、UDP、自定义协议
2. **安全风险**：PAC 是 JS 脚本，理论上可被注入恶意代码（虽然本地生成较安全）
3. **维护复杂**：需要额外开启 HTTP 服务提供 PAC 文件
4. **逐渐淘汰**：Windows/macOS 新版更依赖系统代理或 VPN/TUN

> ✅ 所以 Clash 默认**不启用 PAC**，除非你有特殊需求（如给老旧设备用）

------

## 🔧 六、什么时候你会用到 PAC？

| 场景                            | 说明                                    |
| ------------------------------- | --------------------------------------- |
| **公司内网**                    | IT 部门部署统一 PAC，员工无需配置       |
| **给不支持 TUN 的设备共享代理** | 如旧版 iPad、智能电视（如果它支持 PAC） |
| **调试规则**                    | 临时用浏览器测试某个域名是否匹配代理    |

------

## ✅ 总结

| 你的疑问                     | 答案                                    |
| ---------------------------- | --------------------------------------- |
| **PAC 是什么？**             | 一个 JS 脚本，告诉软件“哪些网站走代理”  |
| **Clash 为什么要提供 PAC？** | 为了兼容只支持 PAC 的旧软件/设备        |
| **我需要开它吗？**           | ❌ 一般不需要，TUN + System Proxy 已足够 |
| **它和规则有什么关系？**     | PAC 是 Clash 规则的“浏览器可读版本”     |

> 💡 现在你可以自信地说：
>  **“PAC 是上一代的智能代理方案，而 TUN 是下一代的透明代理方案。”**

> **PAC 文件本质上是一个“代理决策脚本”，但它**只被**部分软件（主要是浏览器和系统级支持 PAC 的应用）使用，**绝大多数普通软件根本不会读它**。

------

提问：PAC是如何被使用的？哪些东西在使用？

## ✅ 一句话回答你的核心疑问：

> **PAC 不是“全局生效”的规则，而是“谁愿意读它，谁就用”——目前主要是浏览器、Windows 系统代理、少数企业软件会读；游戏、命令行工具、微信、Steam 等几乎都不支持。**

------

## 🔍 一、PAC 是怎么被“使用”的？

### 前提：操作系统或应用必须**主动启用 PAC 支持**

- 在 Windows/macOS 中，你可以在 **网络设置 → 代理** 里填一个 PAC URL
- 一旦填写，**系统会把这个 PAC 文件“下发”给支持它的应用程序**

### 使用流程：

1. 用户访问 `https://youtube.com`

2. 支持 PAC 的软件

   （如 Chrome）会：

   - 调用系统 API 获取当前 PAC 脚本
   - 执行 `FindProxyForURL("https://youtube.com", "youtube.com")`
   - 根据返回结果决定：走代理 or 直连

3. 不支持 PAC 的软件

   （如 Telegram、原神）：

   - 完全忽略 PAC
   - 要么走系统代理（如果设了），要么直连

> 📌 关键：**PAC 不是自动全局生效的魔法文件，它依赖软件主动集成 PAC 解析能力。**

------

## 🧩 二、哪些软件会使用 PAC？（真实情况）

| 软件类型                          | 是否支持 PAC  | 说明                              |
| --------------------------------- | ------------- | --------------------------------- |
| **Chrome / Edge / Firefox**       | ✅ 是          | 浏览器是 PAC 的主要用户           |
| **Safari (macOS)**                | ✅ 是          | 遵守系统代理设置                  |
| **Windows 系统组件**              | ⚠️ 部分支持    | 如 Microsoft Store、部分 UWP 应用 |
| **Office / Outlook**              | ✅（企业环境） | 在域环境中会读 PAC                |
| **curl / wget / Python requests** | ❌ 否          | 默认不读系统 PAC，需手动指定代理  |
| **Telegram / Discord / Steam**    | ❌ 否          | 即使系统设了 PAC，它们也无视      |
| **游戏（原神、LOL 等）**          | ❌ 否          | 完全不支持                        |
| **Docker / Git / npm**            | ❌ 否          | 需要单独配置 HTTP_PROXY 环境变量  |

> 💡 实测结论：**除了浏览器和少数企业软件，90% 的日常应用根本不看 PAC。**

------

## 🌐 三、为什么公司喜欢用 PAC？

因为在**企业 IT 管理场景**中：

- 所有员工电脑加入域（Domain）
- IT 部门通过组策略（GPO）**统一推送 PAC URL**
- 员工打开 Chrome → 自动按规则分流：
  - 访问内网（`*.company.com`）→ 直连
  - 访问外网 → 走公司代理服务器

✅ 这样既保证安全，又无需每台电脑手动配代理。

但**家庭用户没有这种集中管理需求**，所以 PAC 在个人场景几乎无用。

------

## ⚖️ 四、PAC vs Clash TUN：为什么 TUN 更强大？

| 能力                 | PAC               | Clash TUN                                |
| -------------------- | ----------------- | ---------------------------------------- |
| **作用范围**         | 仅支持 PAC 的软件 | **所有网络流量**（包括不支持代理的程序） |
| **判断依据**         | 仅域名（host）    | 域名、IP、端口、协议、GeoIP、进程名……    |
| **UDP 支持**         | ❌ 不支持          | ✅ 支持（如游戏、VoIP）                   |
| **是否需要软件配合** | ✅ 需要            | ❌ 不需要（操作系统级拦截）               |

### 举个例子：

你想让 **《原神》走代理**：

- **PAC**：❌ 无效（原神不读 PAC）
- **TUN**：✅ 自动识别连接目标，按规则转发

------

## 🛠️ 五、技术细节：PAC 在 Windows 中如何工作？

当你在 Windows 设置中填了 PAC URL（如 `http://127.0.0.1:7890/pac`）：

1. 系统会定期下载这个 JS 文件并缓存

2. 当支持 WinHTTP 或 WinINet 的应用

   发起网络请求时：

   - 系统调用 `WinHttpGetProxyForUrl()` API
   - 内部执行 PAC 脚本
   - 返回代理地址给应用

3. 应用根据返回结果决定是否走代理

> 🔑 但注意：**只有使用 Windows 标准网络库的应用才会触发这个机制**。
>  很多跨平台软件（如 Electron、Qt、Java 程序）用自己的网络栈，**绕过系统 PAC**。

------

## ✅ 六、总结：PAC 的真实定位

| 问题                                               | 答案                                                         |
| -------------------------------------------------- | ------------------------------------------------------------ |
| **PAC 是全局规则吗？**                             | ❌ 不是，只对支持它的软件生效                                 |
| **哪些软件会用它？**                               | ✅ 主要是浏览器 + 企业级 Windows 应用                         |
| **Clash 为什么要提供 PAC？**                       | 为了兼容旧设备/企业场景，或给浏览器做精细分流（虽然 TUN 也能做到） |
| **我需要开它吗？**                                 | ❌ 个人用户一般不需要，TUN + System Proxy 更全面              |
| **“PAC = Clash 规则的浏览器兼容版本”是什么意思？** | 意思是：Clash 把自己的规则转换成浏览器能理解的 JS 脚本，让浏览器也能智能分流 |