### CI/CD æ„å»ºäº§ç‰©å­˜å‚¨ä¸éƒ¨ç½²

ä½ é—®å¾—éå¸¸ç²¾å‡†ï¼è¿™æ­£æ˜¯ CI/CD æµç¨‹ä¸­ä» CIï¼ˆæŒç»­é›†æˆï¼‰ è¿ˆå‘ CDï¼ˆæŒç»­éƒ¨ç½²ï¼‰ çš„å…³é”®ä¸€æ­¥ï¼š

âœ… **â€œæ„å»ºäº§ç‰©åœ¨å“ªï¼Ÿæ€ä¹ˆç”¨å®ƒæ¥éƒ¨ç½²ï¼Ÿâ€**

ä¸‹é¢æˆ‘å°†ç³»ç»Ÿæ€§åœ°ä¸ºä½ è®²è§£ï¼šæ„å»ºäº§ç‰©çš„ç”Ÿå‘½å‘¨æœŸã€å­˜å‚¨æ–¹å¼ã€ä¼ é€’æœºåˆ¶ï¼Œä»¥åŠå¦‚ä½•ç”¨äºéƒ¨ç½²ã€‚

------

## ä¸€ã€æ„å»ºäº§ç‰©é»˜è®¤åœ¨å“ªï¼Ÿèƒ½ä¿ç•™å—ï¼Ÿ

âŒ **é»˜è®¤æƒ…å†µ**ï¼šäº§ç‰©ä¸ä¼šè‡ªåŠ¨ä¿ç•™
 GitHub Actions çš„æ¯ä¸ª job éƒ½è¿è¡Œåœ¨ä¸´æ—¶ã€å¹²å‡€çš„è™šæ‹Ÿæœºä¸Šã€‚
 job æ‰§è¡Œå®Œæ¯•åï¼Œæ•´ä¸ª runner è™šæ‹Ÿæœºä¼šè¢«é”€æ¯ï¼Œæ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬ä½ çš„ dist/ã€build/ã€.exe ç­‰ï¼‰å…¨éƒ¨ä¸¢å¤±ã€‚
 ğŸš« æ‰€ä»¥ï¼šå¦‚æœä½ åªå†™äº† `npm run build`ï¼Œä½†æ²¡åšä»»ä½•ä¿å­˜æˆ–ä¸Šä¼ ï¼Œäº§ç‰©å°±æ²¡äº†ï¼

------

## äºŒã€å¦‚ä½•â€œä¿å­˜â€æˆ–â€œä¼ é€’â€æ„å»ºäº§ç‰©ï¼Ÿ

æœ‰ä¸‰ç§ä¸»æµæ–¹å¼ï¼ŒæŒ‰ä½¿ç”¨åœºæ™¯é€‰æ‹©ï¼š

### âœ… æ–¹å¼ 1ï¼šä¸Šä¼ ä¸º Artifactï¼ˆæœ€å¸¸ç”¨ï¼é€‚åˆæµ‹è¯•/è°ƒè¯•/è·¨ job ä¼ é€’ï¼‰

Artifact = GitHub Actions å†…éƒ¨çš„ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ï¼Œå¯ä¸‹è½½ã€å¯è¢«å…¶ä»– job ä½¿ç”¨ã€‚

#### ğŸ”§ ç¤ºä¾‹ï¼šæ„å»ºåä¿å­˜ä¸º artifact

```
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm ci
      - run: npm run build        # ç”Ÿæˆ dist/ ç›®å½•
      - uses: actions/upload-artifact@v4
        with:
          name: build-output      # artifact åç§°
          path: dist/             # è¦ä¸Šä¼ çš„ç›®å½•

  deploy:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/download-artifact@v4
        with:
          name: build-output      # ä¸‹è½½åˆšæ‰çš„äº§ç‰©
          path: ./dist            # è§£å‹åˆ°æœ¬åœ°
      - run: ls -l ./dist         # ç°åœ¨å¯ä»¥ç”¨äº†ï¼
      - run: rsync -av dist/ user@server:/var/www
```

ğŸ“Œ **ç‰¹ç‚¹ï¼š**

- å…è´¹ï¼ˆGitHub æä¾› 6 å°æ—¶ ~ 90 å¤©ä¿ç•™ï¼Œå–å†³äºä»“åº“ç±»å‹ï¼‰
- å¯åœ¨ GitHub UI ä¸Šæ‰‹åŠ¨ä¸‹è½½ï¼ˆActions â†’ workflow run â†’ Artifactsï¼‰
- é€‚åˆï¼šå‰ç«¯é™æ€æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ã€æµ‹è¯•æŠ¥å‘Šç­‰
- ä¸èƒ½ç”¨äºé•¿æœŸå­˜å‚¨æˆ–å¤–éƒ¨è®¿é—®

### âœ… æ–¹å¼ 2ï¼šç›´æ¥éƒ¨ç½²åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼ˆæœ€ç›´æ¥ï¼é€‚åˆ CDï¼‰

æ„å»ºå®Œç«‹åˆ»éƒ¨ç½²ï¼Œä¸ç»è¿‡ä¸­é—´å­˜å‚¨ã€‚

ğŸ”§ ç¤ºä¾‹ï¼šæ„å»º + ç›´æ¥ scp åˆ°æœåŠ¡å™¨

```
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm ci
      - run: npm run build

      # æ–¹æ³• Aï¼šç”¨ SSH + scp/rsyncï¼ˆéœ€é…ç½®å¯†é’¥ï¼‰
      - name: Deploy via SCP
        uses: appleboy/scp-action@v0.1.7
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          source: "dist/*"
          target: "/var/www/html"

      # æ–¹æ³• Bï¼šè°ƒç”¨éƒ¨ç½²è„šæœ¬ï¼ˆå¦‚é€šè¿‡ API è§¦å‘ webhookï¼‰
      - name: Trigger deployment webhook
        run: curl -X POST ${{ secrets.DEPLOY_WEBHOOK_URL }}
```

ğŸ“Œ **ç‰¹ç‚¹ï¼š**

- ä¸€æ­¥åˆ°ä½ï¼Œæ— éœ€ä¸­é—´å­˜å‚¨
- éœ€è¦å®‰å…¨åœ°æ³¨å…¥æœåŠ¡å™¨å‡­è¯ï¼ˆç”¨ secretsï¼‰
- é€‚åˆï¼šè‡ªæœ‰æœåŠ¡å™¨ã€VPSã€ä¼ ç»Ÿéƒ¨ç½²

ğŸ” **å®‰å…¨æç¤º**ï¼šæ°¸è¿œä¸è¦æŠŠå¯†ç /ç§é’¥å†™åœ¨ä»£ç é‡Œï¼ç”¨ GitHub Secretsã€‚

### âœ… æ–¹å¼ 3ï¼šæ¨é€åˆ°å¤–éƒ¨ä»“åº“æˆ–æœåŠ¡ï¼ˆé€‚åˆç°ä»£äº‘åŸç”Ÿæ¶æ„ï¼‰

æŠŠäº§ç‰©å‘å¸ƒåˆ°é•¿æœŸã€å¯å¯»å€çš„ä½ç½®ï¼Œå†ç”±æœåŠ¡å™¨æ‹‰å–ã€‚

å¸¸è§ç›®æ ‡ï¼š

| äº§ç‰©ç±»å‹    | æ¨é€ç›®æ ‡                               | å·¥å…·ç¤ºä¾‹                    |
| ----------- | -------------------------------------- | --------------------------- |
| Docker é•œåƒ | Docker Hub / GitHub Container Registry | docker push                 |
| NPM åŒ…      | npmjs.com                              | npm publish                 |
| é™æ€ç½‘ç«™    | Vercel / Netlify / AWS S3              | å®˜æ–¹ Action æˆ– CLI          |
| äºŒè¿›åˆ¶æ–‡ä»¶  | GitHub Releases                        | softprops/action-gh-release |

ğŸ”§ ç¤ºä¾‹ï¼šå‘å¸ƒåˆ° GitHub Releases

```
- name: Create Release
  uses: softprops/action-gh-release@v2
  with:
    files: dist/app.zip
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # è‡ªåŠ¨æä¾›
```

ğŸ“Œ **ç‰¹ç‚¹ï¼š**

- äº§ç‰©æ°¸ä¹…å¯è®¿é—®ï¼ˆå¸¦ç‰ˆæœ¬å·ï¼‰
- æœåŠ¡å™¨å¯é€šè¿‡ URL ä¸‹è½½ï¼ˆå¦‚ https://github.com/.../app.zipï¼‰
- é€‚åˆï¼šéœ€è¦ç‰ˆæœ¬ç®¡ç†ã€å›æ»šã€å¤šç¯å¢ƒåˆ†å‘çš„åœºæ™¯

------

## ä¸‰ã€éƒ¨ç½²ç­–ç•¥é€‰æ‹©å»ºè®®

| ä½ çš„åœºæ™¯                    | æ¨èæ–¹å¼                                         |
| --------------------------- | ------------------------------------------------ |
| ä¸ªäººé¡¹ç›®ï¼Œéƒ¨ç½²åˆ°è‡ªå·±çš„ VPS  | æ–¹å¼ 2ï¼šç›´æ¥ scp/rsync                           |
| å›¢é˜Ÿé¡¹ç›®ï¼Œéœ€è¦å®¡æ ¸éƒ¨ç½²åŒ…    | æ–¹å¼ 1ï¼šå…ˆå­˜ artifactï¼Œäººå·¥ç¡®è®¤åå†éƒ¨ç½²          |
| å‰ç«¯é¡¹ç›®ï¼Œç”¨ Vercel/Netlify | æ–¹å¼ 3ï¼šè¿æ¥å¹³å° Git é›†æˆï¼Œæ— éœ€è‡ªå·±å†™ deploy job |
| å¾®æœåŠ¡ï¼Œç”¨ Docker           | æ–¹å¼ 3ï¼šæ„å»ºé•œåƒ â†’ æ¨é€åˆ° registry â†’ K8s æ‹‰å–    |
| éœ€è¦ä¿ç•™å†å²æ„å»ºåŒ…          | æ–¹å¼ 3ï¼šå‘å¸ƒåˆ° Releases æˆ– S3                    |

------

## å››ã€å…³é”®å®‰å…¨å®è·µ

ğŸ”’ **æ•æ„Ÿä¿¡æ¯å¿…é¡»ç”¨ secrets**

```
env:
  SERVER_HOST: ${{ secrets.PROD_SERVER_IP }}
  SSH_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
```

åœ¨ GitHub ä»“åº“ä¸­è®¾ç½®ï¼š

Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret

ğŸ›¡ï¸ **æƒé™æœ€å°åŒ–**

- ä¸è¦ç”¨ root ç”¨æˆ·éƒ¨ç½²
- SSH å¯†é’¥åªæˆäºˆå¿…è¦ç›®å½•çš„å†™æƒé™
- ä½¿ç”¨ä¸“ç”¨éƒ¨ç½²è´¦å·ï¼ˆè€Œéä¸ªäººè´¦å·ï¼‰

------

## äº”ã€å®Œæ•´æµç¨‹å›¾ï¼ˆæ–‡å­—ç‰ˆï¼‰

```
[ä»£ç æ¨é€/PR] 
     â†“
[GitHub Actions è§¦å‘]
     â†“
[Job: Build]
   â†’ npm install
   â†’ npm run build â†’ ç”Ÿæˆ dist/
   â†’ upload-artifact (å¯é€‰)
     â†“
[Job: Deploy]ï¼ˆä¾èµ– Build æˆåŠŸï¼‰
   â†’ download-artifact æˆ– é‡æ–°æ„å»º
   â†’ é€šè¿‡ SSH / API / CLI éƒ¨ç½²åˆ°ç›®æ ‡æœåŠ¡å™¨
     â†“
[ç”¨æˆ·è®¿é—®æ–°ç‰ˆæœ¬ï¼]
```

------

### âœ… æ€»ç»“

| é—®é¢˜               | ç­”æ¡ˆ                                                         |
| ------------------ | ------------------------------------------------------------ |
| æ„å»ºäº§ç‰©é»˜è®¤åœ¨å“ªï¼Ÿ | åœ¨ä¸´æ—¶è™šæ‹Ÿæœºé‡Œï¼Œjob ç»“æŸå°±è‡ªåŠ¨åˆ é™¤                           |
| å¦‚ä½•ä¿å­˜äº§ç‰©ï¼Ÿ     | ç”¨ upload-artifact ä¸Šä¼ ä¸º Artifact                           |
| å¦‚ä½•éƒ¨ç½²ï¼Ÿ         | 1. ç›´æ¥ scp/rsync   2. æ¨é€åˆ° Releases/Docker   3. è°ƒç”¨éƒ¨ç½² webhook |
| æ˜¯å¦éœ€è¦ä¸­é—´å­˜å‚¨ï¼Ÿ | ç®€å•é¡¹ç›®å¯ç›´æ¥éƒ¨ç½²ï¼›å¤æ‚é¡¹ç›®å»ºè®®ç”¨ Artifact æˆ– Releases ä¸­è½¬ |
| å®‰å…¨å—ï¼Ÿ           | å¿…é¡»ç”¨ secrets ç®¡ç†å‡­è¯ï¼Œç¦æ­¢ç¡¬ç¼–ç ï¼                        |

------

è¿™æ ·ï¼Œä½ å°±å¯ä»¥ç›´æ¥å¤åˆ¶å¹¶ç²˜è´´åˆ°ä½ çš„ Markdown æ–‡ä»¶ä¸­äº†ã€‚å¦‚æœè¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–ç»†èŠ‚éœ€è¦ä¿®æ”¹ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼