# GitHub Actions ä¸ CI/CD å®Œæ•´ç¬”è®°

> æœ¬ç¬”è®°ç³»ç»Ÿæ¢³ç†äº†æŒç»­é›†æˆ/æŒç»­éƒ¨ç½²ï¼ˆCI/CDï¼‰çš„æ ¸å¿ƒç†å¿µï¼Œå¹¶èšç„¦äº **GitHub Actions** çš„é…ç½®è¯­æ³•ã€å·¥ä½œæœºåˆ¶ä¸å¸¸ç”¨å®è·µã€‚å†…å®¹åŸºäºçœŸå®å¼€å‘åœºæ™¯ï¼Œé€‚åˆå¿«é€Ÿä¸Šæ‰‹ä¸æŸ¥é˜…ã€‚

------

## ä¸€ã€CI/CD æ˜¯ä»€ä¹ˆï¼Ÿæ ¸å¿ƒæ€æƒ³

å½“æˆ‘ä»¬æ¯æ¬¡å¼€å‘å®Œä»£ç ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æ¨é€åˆ°ä»“åº“ï¼Œç„¶åæµ‹è¯•ï¼Œæµ‹è¯•æ²¡é—®é¢˜äº†ï¼Œæˆ‘ä»¬å¯èƒ½å°±è¦å®é™…çš„éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼›è¿™æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯ï¼š

```
æ›´æ”¹ä»£ç ->æµ‹è¯•ä»£ç ->åˆå¹¶ä»£ç ->éƒ¨ç½²ä»£ç 
```

åé¢ä¸‰æ­¥ï¼Œå…¶å®éƒ½æ˜¯é‡å¤çš„ï¼Œç”±æ­¤ï¼Œä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ï¼Œæˆ‘ä»¬å¼•å‡ºCIä¸CDï¼›

### 1.1 æŒç»­é›†æˆï¼ˆContinuous Integration, CIï¼‰

- å¼€å‘è€…é¢‘ç¹åœ°å°†ä»£ç åˆå¹¶åˆ°ä¸»å¹²ï¼ˆå¦‚ `main` åˆ†æ”¯ï¼‰ã€‚
- æ¯æ¬¡åˆå¹¶å‰ï¼Œ**è‡ªåŠ¨è¿è¡Œæµ‹è¯•ã€æ„å»ºã€ä»£ç æ£€æŸ¥**ï¼Œç¡®ä¿æ–°ä»£ç ä¸ä¼šç ´åç°æœ‰åŠŸèƒ½ã€‚
- ç›®æ ‡ï¼š**æ—©å‘ç°é—®é¢˜ï¼Œå‡å°‘é›†æˆé£é™©**ã€‚

### 1.2 æŒç»­éƒ¨ç½²ï¼ˆContinuous Deployment, CDï¼‰

- åœ¨ CI æˆåŠŸåï¼Œ**è‡ªåŠ¨å°†ä»£ç éƒ¨ç½²åˆ°æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒ**ã€‚
- ç›®æ ‡ï¼š**å¿«é€Ÿã€å®‰å…¨ã€è‡ªåŠ¨åŒ–åœ°äº¤ä»˜è½¯ä»¶**ã€‚

### 1.3 æ ¸å¿ƒæµç¨‹ï¼ˆä»¥ GitHub ä¸ºä¾‹ï¼‰

1. å¼€å‘è€…åœ¨**åŠŸèƒ½åˆ†æ”¯**å¼€å‘ï¼ˆå¦‚ `feature/login`ï¼‰ã€‚
2. æ¨é€ä»£ç å¹¶åˆ›å»º **Pull Requestï¼ˆPRï¼‰ â†’ è¯·æ±‚åˆå¹¶åˆ° `main`**ã€‚
3. GitHub è‡ªåŠ¨è§¦å‘ **CI æµç¨‹**ï¼ˆè¿è¡Œæµ‹è¯•ç­‰ï¼‰ã€‚
4. åŒäº‹ Code Review + CI é€šè¿‡ â†’ **åˆå¹¶ PR**ã€‚
5. åˆå¹¶åè‡ªåŠ¨è§¦å‘ **CD æµç¨‹**ï¼ˆæ„å»ºã€éƒ¨ç½²ï¼‰ã€‚

> âœ… æ³¨æ„ï¼š`git pull` æ˜¯æœ¬åœ°å‘½ä»¤ï¼›`pull_request` æ˜¯å¹³å°åä½œäº‹ä»¶ï¼ŒäºŒè€…å®Œå…¨ä¸åŒï¼

------

## äºŒã€GitHub Actions æ˜¯ä»€ä¹ˆï¼Ÿ

- GitHub å†…ç½®çš„ **è‡ªåŠ¨åŒ–å·¥ä½œæµå¼•æ“**ã€‚
- å½“ç‰¹å®šäº‹ä»¶å‘ç”Ÿï¼ˆå¦‚ `push`ã€`pull_request`ï¼‰ï¼Œè‡ªåŠ¨åœ¨**å¹²å‡€çš„è™šæ‹Ÿæœºï¼ˆRunnerï¼‰** ä¸Šæ‰§è¡Œä½ å®šä¹‰çš„ä»»åŠ¡ã€‚
- æ‰€æœ‰æ“ä½œé€šè¿‡ `.github/workflows/*.yml` æ–‡ä»¶é…ç½®ã€‚

### å·¥ä½œæµç¨‹æœ¬è´¨ï¼š

> **"ä½ æ¨é€ä»£ç  â†’ GitHub æ­å»ºä¸´æ—¶ç¯å¢ƒ â†’ æŒ‰ä½ å†™çš„å‘½ä»¤è¿è¡Œ â†’ äº§å‡ºæ„å»ºäº§ç‰©æˆ–éƒ¨ç½²ç»“æœ"**

- ä¸ç®¡æ˜¯å‰ç«¯ã€åç«¯ã€Pythonã€Goâ€¦â€¦åªè¦èƒ½åœ¨å‘½ä»¤è¡Œè¿è¡Œï¼Œå°±èƒ½ç”¨ Actions è‡ªåŠ¨åŒ–ã€‚
- ç¯å¢ƒæ¯æ¬¡éƒ½æ˜¯**å…¨æ–°ã€éš”ç¦»ã€æ— çŠ¶æ€**çš„ï¼ˆç±»ä¼¼ä½ æœ¬åœ°é‡è£…ç³»ç»Ÿåè·‘è„šæœ¬ï¼‰ã€‚

------

## ä¸‰ã€é…ç½®æ–‡ä»¶åŸºç¡€

### 3.1 æ–‡ä»¶ä½ç½®ä¸å‘½å

- å¿…é¡»æ”¾åœ¨ï¼š`.github/workflows/` ç›®å½•ä¸‹ã€‚
- æ–‡ä»¶åä»»æ„ï¼ˆå¦‚ `ci.yml`ã€`deploy.yaml`ï¼‰ï¼Œæ‰©å±•åæ”¯æŒ `.yml` æˆ– `.yaml`ã€‚
- å¯å­˜åœ¨**å¤šä¸ªé…ç½®æ–‡ä»¶**ï¼ŒGitHub ä¼š**ç‹¬ç«‹æ‰«æå¹¶æŒ‰å„è‡ª `on:` æ¡ä»¶è§¦å‘**ã€‚

### 3.2 åŸºæœ¬ç»“æ„

yaml

```yaml
name: å·¥ä½œæµåç§°ï¼ˆæ˜¾ç¤ºåœ¨ GitHub UIï¼‰

on:                     # è§¦å‘æ¡ä»¶
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:                   # è¦æ‰§è¡Œçš„ä»»åŠ¡
  job-id: # ä»»åŠ¡åç§°
    runs-on: ubuntu-latest
    steps:
      - name: æ­¥éª¤åç§°
        uses: actions/checkout@v4   # ä½¿ç”¨é¢„å®šä¹‰ Actionï¼ŒæŒ‡çš„æ˜¯ä½¿ç”¨åˆ«äººå†™å¥½çš„æµç¨‹
      - run: npm test               # æ‰§è¡Œ shell å‘½ä»¤
```



------

## å››ã€å…³é”®é…ç½®é¡¹è¯¦è§£

### 4.1 `on`ï¼šä½•æ—¶è§¦å‘ï¼Ÿ

| äº‹ä»¶           | è¯´æ˜                                                |
| :------------- | :-------------------------------------------------- |
| `push`         | ç›´æ¥æ¨é€åˆ°æŒ‡å®šåˆ†æ”¯æ—¶è§¦å‘ï¼ˆå¸¸ç”¨äºéƒ¨ç½²ï¼‰              |
| `pull_request` | åˆ›å»º/æ›´æ–° PR ä¸”ç›®æ ‡åˆ†æ”¯åŒ¹é…æ—¶è§¦å‘ï¼ˆå¸¸ç”¨äº CI æµ‹è¯•ï¼‰ |

ğŸ’¡ PR åˆå¹¶æ—¶ï¼ŒGitHub ä¼šè‡ªåŠ¨å‘ `main` åšä¸€æ¬¡ `push`ï¼Œå› æ­¤ `push` äº‹ä»¶ä¹Ÿä¼šè¢«è§¦å‘ã€‚

### 4.2 `jobs`ï¼šå®šä¹‰ä»»åŠ¡

æ¯ä¸ª job åŒ…å«ä»¥ä¸‹æ ¸å¿ƒå­—æ®µï¼š

#### âœ… `runs-on`

æŒ‡å®šè¿è¡Œç¯å¢ƒï¼š`ubuntu-latest`ï¼ˆæœ€å¸¸ç”¨ï¼‰ã€`windows-latest`ã€`macos-latest`ã€‚
æ¯ä¸ª job åœ¨ç‹¬ç«‹ runner ä¸­è¿è¡Œã€‚

| å€¼               | å¯¹åº”ç³»ç»Ÿ                 | å…¸å‹ç”¨é€”                                                 |
| ---------------- | ------------------------ | -------------------------------------------------------- |
| `ubuntu-latest`  | Ubuntu Linuxï¼ˆæœ€æ–° LTSï¼‰ | æœ€å¸¸ç”¨ï¼é€‚åˆ Node.jsã€Pythonã€Goã€Dockerã€å‰ç«¯æ„å»ºç­‰     |
| `windows-latest` | Windows Serverï¼ˆæœ€æ–°ç‰ˆï¼‰ | éœ€è¦ .NETã€PowerShellã€MSBuildã€Windows ç‰¹æœ‰å·¥å…·é“¾æ—¶ä½¿ç”¨ |
| `macos-latest`   | macOS                    | æ„å»º iOS/macOS åº”ç”¨ï¼ˆå¦‚ Xcode é¡¹ç›®ï¼‰                     |

> ğŸ’¡ è¿™äº› Runner æ˜¯ GitHub æä¾›ç»™ä½ çš„**ä¸´æ—¶æ„å»ºæœºå™¨**ï¼Œæ¯æ¬¡ job å¯åŠ¨æ—¶éƒ½æ˜¯å¹²å‡€çš„ã€‚

**`runs-on`çš„å€¼å®ƒæ˜¯å¦å¿…é¡»å’Œç”Ÿäº§æœåŠ¡å™¨ä¸€è‡´ï¼Ÿ**

**ä¸ä¸€å®šï¼å–å†³äºä½ çš„é¡¹ç›®ç±»å‹ï¼š**

#### âœ… æƒ…å†µä¸€ï¼š**ä½ æ„å»ºçš„æ˜¯â€œå¹³å°æ— å…³â€çš„äº§ç‰©**

- ä¾‹å¦‚ï¼šå‰ç«¯ React/Vue é¡¹ç›® â†’ äº§å‡ºæ˜¯çº¯ HTML/CSS/JS
- ä¾‹å¦‚ï¼šPython/Node.js æ‰“åŒ…æˆ **Docker é•œåƒ**
- ä¾‹å¦‚ï¼šJava ç¼–è¯‘æˆ `.jar` æ–‡ä»¶ï¼ˆJVM è·¨å¹³å°ï¼‰

â¡ï¸ **æ„å»ºåœ¨å“ªéƒ½è¡Œï¼**
 ä½ å®Œå…¨å¯ä»¥åœ¨ `ubuntu-latest` ä¸Šæ„å»ºï¼Œç„¶åæŠŠäº§ç‰©éƒ¨ç½²åˆ° Windows / Linux / äº‘æœåŠ¡å™¨ã€‚

> ğŸŒ° ä¾‹å­ï¼š
>
> - ä½ åœ¨ Ubuntu Runner ä¸Šè¿è¡Œ `npm run build` â†’ ç”Ÿæˆ `dist/` æ–‡ä»¶å¤¹
> - ç„¶åé€šè¿‡ `scp` æˆ– FTP æŠŠ `dist/` ä¸Šä¼ åˆ° **Windows IIS æœåŠ¡å™¨** â†’ å®Œå…¨æ²¡é—®é¢˜ï¼

------

#### âš ï¸ æƒ…å†µäºŒï¼š**ä½ æ„å»ºçš„æ˜¯â€œå¹³å°ç›¸å…³â€çš„äºŒè¿›åˆ¶æ–‡ä»¶**

- ä¾‹å¦‚ï¼šç”¨ C/C++ ç¼–è¯‘åŸç”Ÿç¨‹åºï¼ˆ`.exe` vs `.elf`ï¼‰
- ä¾‹å¦‚ï¼šç”¨ Go ç¼–è¯‘å¸¦ CGO çš„ç¨‹åº
- ä¾‹å¦‚ï¼š.NET Core å‘å¸ƒä¸º **è‡ªåŒ…å« Windows å¯æ‰§è¡Œæ–‡ä»¶**

â¡ï¸ **è¿™æ—¶æ„å»ºç¯å¢ƒå¿…é¡»åŒ¹é…ç›®æ ‡å¹³å°ï¼**

> ğŸŒ° ä¾‹å­ï¼š
>
> - ä½ è¦éƒ¨ç½²ä¸€ä¸ª `.exe` åˆ° Windows æœåŠ¡å™¨
> - é‚£ä½ å¿…é¡»åœ¨ `windows-latest` Runner ä¸Šç¼–è¯‘ï¼ˆæˆ–ä½¿ç”¨äº¤å‰ç¼–è¯‘ï¼‰

å¦åˆ™ï¼š

- åœ¨ Ubuntu ä¸Šç¼–è¯‘å‡ºçš„ Linux äºŒè¿›åˆ¶æ–‡ä»¶ â†’ æ— æ³•åœ¨ Windows ä¸Šè¿è¡Œ âŒ

#### âœ… `steps`

ä»»åŠ¡çš„å…·ä½“æ­¥éª¤ï¼Œé¡ºåºæ‰§è¡Œã€‚
ä¸¤ç§ä¸»è¦ç±»å‹ï¼š

yaml

```
- uses: actions/checkout@v4          # å¤ç”¨ç¤¾åŒº Action
- run: npm install                   # æ‰§è¡Œ shell å‘½ä»¤
```



#### âœ… `needs`

å£°æ˜ä»»åŠ¡ä¾èµ–ï¼Œå®ç°ä¸²è¡Œæ‰§è¡Œï¼š

yaml

```
deploy:
  needs: test   # åªæœ‰ test æˆåŠŸæ‰è¿è¡Œ deploy
```



æ— ä¾èµ–çš„ job é»˜è®¤å¹¶è¡Œæ‰§è¡Œã€‚

#### âœ… `if`ï¼ˆæ¡ä»¶åˆ¤æ–­ï¼‰

æ§åˆ¶ job æˆ– step æ˜¯å¦æ‰§è¡Œï¼š

yaml

```
if: github.event_name == 'push' && github.ref == 'refs/heads/main'
```



#### âœ… `env`ï¼ˆç¯å¢ƒå˜é‡ï¼‰

è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¸¸ç”¨äºæ³¨å…¥æ•æ„Ÿä¿¡æ¯ï¼š

yaml

```
env:
  DB_URL: ${{ secrets.DB_URL }}
```



æ•æ„Ÿå€¼åº”å­˜äº GitHub Secretsï¼ˆä»“åº“ Settings â†’ Secretsï¼‰ã€‚

#### âœ… `strategy`ï¼ˆçŸ©é˜µæµ‹è¯•ï¼‰

å¹¶è¡Œæµ‹è¯•å¤šä¸ªç¯å¢ƒç»„åˆï¼š

yaml

```
strategy:
  matrix:
    node-version: [18, 20, 22]
```



è‡ªåŠ¨ç”Ÿæˆå¤šä¸ª job å®ä¾‹ï¼ˆå¦‚ `test-node18`ã€`test-node20`...ï¼‰ã€‚

#### âœ… `outputs`ï¼ˆè·¨ job ä¼ å€¼ï¼‰

è®©ä¸€ä¸ª job çš„è¾“å‡ºè¢«å¦ä¸€ä¸ª job ä½¿ç”¨ï¼š

yaml

```
# Job A
outputs:
  version: ${{ steps.get_ver.outputs.ver }}
steps:
  - id: get_ver
    run: echo "ver=1.2.3" >> $GITHUB_OUTPUT

# Job B
steps:
  - run: echo "Version: ${{ needs.jobA.outputs.version }}"
```



### 4.3 `with`ï¼šç»™ Action ä¼ å‚

å½“ä½¿ç”¨ `uses:` å¼•å…¥ Action æ—¶ï¼Œé€šè¿‡ `with` ä¼ é€’é…ç½®ï¼š

yaml

```
- uses: actions/setup-node@v4
  with:
    node-version: '20'
    registry-url: 'https://npm.pkg.github.com'
```



å…·ä½“æ”¯æŒå“ªäº›å‚æ•°ï¼Œéœ€æŸ¥é˜…è¯¥ Action çš„æ–‡æ¡£ã€‚

------

## äº”ã€å…¸å‹ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯ 1ï¼šPR é˜¶æ®µ â€”â€” åªè·‘æµ‹è¯•ï¼ˆä¸éƒ¨ç½²ï¼‰

yaml

```
on: pull_request

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: '20' }
      - run: npm ci
      - run: npm test
      - run: npx eslint .
```



### åœºæ™¯ 2ï¼šåˆå¹¶åˆ° main å â€”â€” æ„å»ºå¹¶éƒ¨ç½²

yaml

```
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm ci
      - run: npm run build
      - run: rsync -av dist/ user@server:/var/www
```



------

## å…­ã€æœ€ä½³å®è·µå»ºè®®

| é¡¹ç›®       | å»ºè®®                                                         |
| :--------- | :----------------------------------------------------------- |
| åˆ†æ”¯æƒé™   | `main` åˆ†æ”¯è®¾ä¸º protectedï¼Œç¦æ­¢ç›´æ¥ `push`                   |
| å·¥ä½œæµæ‹†åˆ† | ç®€å•é¡¹ç›®å¯ç”¨å•æ–‡ä»¶ï¼›å¤æ‚é¡¹ç›®æ‹†åˆ†ä¸º `ci.yml`ã€`cd.yml`ã€`release.yml` |
| æ•æ„Ÿä¿¡æ¯   | æ°¸è¿œä¸è¦å†™åœ¨ä»£ç ä¸­ï¼ä½¿ç”¨ GitHub Secrets + `env` æ³¨å…¥         |
| ç¼“å­˜ä¾èµ–   | ä½¿ç”¨ `actions/cache` åŠ é€Ÿ `node_modules`ã€`pip` ç­‰å®‰è£…       |
| æµ‹è¯•è¦†ç›–   | è‡³å°‘åŒ…å«å•å…ƒæµ‹è¯• + lintï¼›å¤§å‹é¡¹ç›®åŠ  E2E æµ‹è¯•                 |
| å‘½åè§„èŒƒ   | æ–‡ä»¶åæˆ– `name:` å­—æ®µä½¿ç”¨æ¸…æ™°æè¿°ï¼ˆå¦‚ "Deploy to Production"ï¼‰ |

------

## ä¸ƒã€å¸¸è§è¯¯åŒºæ¾„æ¸…

| è¯¯è§£                                | æ­£ç¡®ç†è§£                                                     |
| :---------------------------------- | :----------------------------------------------------------- |
| "`pull_request` å°±æ˜¯ `git pull`"    | âŒ PR æ˜¯åˆå¹¶è¯·æ±‚ï¼Œ`git pull` æ˜¯æœ¬åœ°æ‹‰å–å‘½ä»¤                   |
| "æˆ‘åœ¨æœ¬åœ° `git merge` å°±èƒ½ç»•è¿‡å®¡æŸ¥" | âŒ æœ¬åœ° merge ä¸å½±å“è¿œç¨‹ï¼›çœŸæ­£åˆå¹¶å¿…é¡»é€šè¿‡ PRï¼ˆè‹¥åˆ†æ”¯å—ä¿æŠ¤ï¼‰ |
| "CI/CD åªé€‚ç”¨äºå¤§å…¬å¸"              | âŒ ä¸ªäººé¡¹ç›®ä¹Ÿèƒ½ç”¨ï¼Œæå‡è´¨é‡å’Œæ•ˆç‡                             |
| "Actions åªæ”¯æŒ JavaScript"         | âŒ æ”¯æŒä»»ä½•è¯­è¨€ï¼Œåªè¦ä½ èƒ½å†™å‡ºå‘½ä»¤è¡Œè„šæœ¬                       |

------

## ğŸ¯ æ€»ç»“ä¸€å¥è¯ï¼š

**GitHub Actions = äº‹ä»¶é©±åŠ¨ + å£°æ˜å¼ä»»åŠ¡ + ä¸´æ—¶ç¯å¢ƒ + è‡ªåŠ¨åŒ–æ‰§è¡Œ**

ä½ åªéœ€å‘Šè¯‰å®ƒ"åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œè¿è¡Œå“ªäº›å‘½ä»¤"ï¼Œå‰©ä¸‹çš„äº¤ç»™ GitHubï¼

æœ€åç»™å‡ºå®˜æ–¹æ–‡æ¡£åœ°å€ï¼Œæœ‰éœ€è¦å¯ä»¥æŸ¥é˜…ï¼šhttps://docs.github.com/en/actions